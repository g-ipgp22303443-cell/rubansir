<!DOCTYPE html>
<html lang="ta">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ஐம்பெரும் காப்பியங்கள்</title>
    <!-- Tailwind CSS for modern styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts for a pleasant reading experience -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 1rem auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-slate-200 text-slate-800 flex items-center justify-center min-h-screen p-4">

    <!-- API Key Modal -->
    <div id="api-key-modal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-50">
        <div class="bg-white p-8 rounded-2xl shadow-2xl max-w-md w-full text-center">
            <h2 class="text-2xl font-bold mb-4">Gemini API சாவி தேவை</h2>
            <p class="text-slate-600 mb-6">இந்த வலைதளத்தின் செயற்கை நுண்ணறிவு அம்சங்களைப் பயன்படுத்த, உங்கள் Gemini API சாவியை உள்ளிடவும்.</p>
            <input type="password" id="api-key-input" class="w-full px-4 py-2 border border-slate-300 rounded-lg mb-4" placeholder="உங்கள் API சாவியை இங்கே உள்ளிடவும்">
            <button id="save-api-key-btn" class="w-full bg-blue-600 text-white font-bold py-3 rounded-lg hover:bg-blue-700 transition">சேமித்து தொடரவும்</button>
            <p class="text-xs text-slate-400 mt-4">
                API சாவி இல்லையா? <a href="https://aistudio.google.com/app/apikey" target="_blank" class="text-blue-500 underline">இங்கே இலவசமாகப் பெறுங்கள்</a>.
            </p>
        </div>
    </div>

    <div id="main-content" class="w-full max-w-5xl mx-auto hidden">

        <!-- Story Grid Section (Main Menu) -->
        <div id="story-grid-section" class="fade-in">
            <div class="text-center mb-10">
                <h1 class="text-4xl md:text-5xl font-bold text-slate-700">ஐம்பெரும் காப்பியங்கள்</h1>
                <p class="text-slate-500 mt-2">ஒரு கதையைத் தேர்ந்தெடுக்க பெட்டியைக் கிளிக் செய்யவும்.</p>
                <p class="text-slate-400 mt-4 text-sm">ஆக்கம்: ஆசிரியர் ம.ஹேமரூபன்</p>
            </div>

            <!-- The 4 Boxes Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <!-- Box 1 -->
                <div data-story-id="sundial" class="story-box bg-white p-8 rounded-2xl shadow-lg cursor-pointer transform hover:scale-105 hover:shadow-2xl transition-all duration-300">
                    <h2 class="text-2xl font-bold text-amber-700 mb-2">சிலப்பதிகாரம்</h2>
                    <p class="text-slate-600">நீதிக்காகப் போராடிய கண்ணகியின் கதை.</p>
                </div>
                <!-- Box 2 -->
                <div data-story-id="comet" class="story-box bg-white p-8 rounded-2xl shadow-lg cursor-pointer transform hover:scale-105 hover:shadow-2xl transition-all duration-300">
                    <h2 class="text-2xl font-bold text-indigo-700 mb-2">மணிமேகலை</h2>
                    <p class="text-slate-600">அமுதசுரபி கொண்டு மக்களின் பசி போக்கிய கதை.</p>
                </div>
                <!-- Box 3 -->
                <div data-story-id="forest" class="story-box bg-white p-8 rounded-2xl shadow-lg cursor-pointer transform hover:scale-105 hover:shadow-2xl transition-all duration-300">
                    <h2 class="text-2xl font-bold text-emerald-700 mb-2">சீவக சிந்தாமணி</h2>
                    <p class="text-slate-600">மாவீரன் சீவகனின் கதை.</p>
                </div>
                <!-- Box 4 -->
                <div data-story-id="city" class="story-box bg-white p-8 rounded-2xl shadow-lg cursor-pointer transform hover:scale-105 hover:shadow-2xl transition-all duration-300">
                    <h2 class="text-2xl font-bold text-cyan-700 mb-2">வளையாபதி & குண்டலகேசி</h2>
                    <p class="text-slate-600">முழுமையாகக் கிடைக்காத காப்பியங்கள்.</p>
                </div>
            </div>
        </div>

        <!-- Story Display Section (Initially Hidden) -->
        <div id="story-display-section" class="hidden">
            <div class="bg-white p-8 md:p-12 rounded-2xl shadow-lg max-w-4xl mx-auto">
                <button id="back-btn" class="mb-6 px-5 py-2 bg-slate-600 text-white font-semibold rounded-lg shadow-md hover:bg-slate-700 transition">← பட்டியலுக்குத் திரும்பு</button>
                <h2 id="story-title" class="text-3xl md:text-4xl font-bold mb-4"></h2>
                <div id="story-content" class="text-slate-700 text-lg leading-relaxed space-y-4"></div>
                <!-- Gemini API Features Section -->
                <div id="gemini-features" class="mt-8 pt-6 border-t border-slate-200"></div>
                <div id="gemini-output" class="mt-4 p-4 bg-slate-100 rounded-lg hidden"></div>
            </div>
        </div>

    </div>

    <script>
        // Story Content with the new images
        const stories = {
            sundial: { 
                title: "சிலப்பதிகாரம்", 
                content: `<img src="https://res.cloudinary.com/jerrick/image/upload/d_642250b563292b35f27461a7.png,f_jpg,fl_progressive,q_auto,w_1024/65b3db6fa0f5b7001d6a2a97.jpg" alt="கண்ணகி" class="w-full h-auto object-contain rounded-xl mb-6 shadow-md">
                          <p>சிலப்பதிகாரம் ஒரு மிகப்பழைய தமிழ்க் காப்பியம். இதன் தலைவியின் பெயர் கண்ணகி. அவளுடைய கணவன் கோவலன். பாண்டிய மன்னன், கோவலனைத் தவறுதலாகத் திருடன் என்று நினைத்து அவருக்குத் தண்டனை கொடுத்துவிட்டான். இதைக் கேட்ட கண்ணகி மிகவும் கோபம் கொண்டாள். அவள், மன்னனின் அரசவைக்குச் சென்று, தன் கால் சிலம்பை உடைத்து, தன் கணவன் குற்றமற்றவன் என்பதை நிரூபித்தாள். நீதிக்காகப் போராடிய கண்ணகியை மக்கள் இன்றும் போற்றுகிறார்கள்.</p>` 
            },
            comet: { 
                title: "மணிமேகலை", 
                content: `<img src="https://vikatakavi.in/upload/image/20191113102741865.jpg" alt="மணிமேகலை" class="w-full h-auto object-contain rounded-xl mb-6 shadow-md">
                         <p>மணிமேகலை, சிலப்பதிகாரக் கதையின் தொடர்ச்சியாகும். இதன் தலைவி மணிமேகலை. அவள் மிகவும் இரக்க குணம் கொண்டவள். அவளுக்கு ‘அமுதசுரபி’ என்ற ஒரு அதிசய உணவுப் பாத்திரம் கிடைத்தது. அதில் எடுக்க எடுக்க உணவு குறையவே குறையாது. அந்தப் பாத்திரத்தின் உதவியுடன், மணிமேகலை பசியால் வாடிய ஏழை மக்கள் அனைவருக்கும் உணவு வழங்கி உதவினாள்.</p>` 
            },
            forest: { 
                title: "சீவக சிந்தாமணி", 
                content: `<img src="https://s3.ap-south-1.amazonaws.com/storage.commonfolks.in/docs/products/images_full/seevaga-sinthamani_FrontImage_636.jpg" alt="சீவகன்" class="w-full h-auto object-contain rounded-xl mb-6 shadow-md">
                          <p>சீவக சிந்தாமணி, சீவகன் என்ற ஒரு மாவீரனின் கதையாகும். அவன் ஒரு இளவரசன். அவன் பல கலைகளையும் வித்தைகளையும் கற்றுத் தேர்ந்தான். அவன் மிகவும் அறிவும் வீரமும் கொண்டவன். பல கடினமான போட்டிகளில் வென்று, கடைசியில் ஒரு பெரிய நாட்டின் அரசனாக ஆனான். அவனது திறமையையும் வீரத்தையும் அனைவரும் பாராட்டினர்.</p>` 
            },
            city: { 
                title: "வளையாபதி மற்றும் குண்டலகேசி", 
                content: `<img src="https://gowrabookfair.com/wp-content/uploads/2024/06/0773N-scaled-e1731998386957.jpg" alt="வளையாபதி மற்றும் குண்டலகேசி" class="w-full h-auto object-contain rounded-xl mb-6 shadow-md">
                         <p>வளையாபதி, குண்டலகேசி ஆகிய இரண்டும் ஐம்பெரும் காப்பியங்களில் அடங்கும். இந்த இரண்டு காப்பியங்களின் முழுமையான கதைகளும் இப்போது நமக்குக் கிடைக்கவில்லை. ஆனால், இந்தக் கதைகளும் நல்ல கருத்துக்களையும், உண்மையாக வாழ்வதன் முக்கியத்துவத்தையும் கூறுவதாகப் பெரியவர்கள் சொல்கிறார்கள். இவையும் நமது மொழியின் மதிப்புமிக்க காப்பியங்கள் ஆகும்.</p>` 
            }
        };

        // DOM Elements
        const apiKeyModal = document.getElementById('api-key-modal');
        const saveApiKeyBtn = document.getElementById('save-api-key-btn');
        const apiKeyInput = document.getElementById('api-key-input');
        const mainContent = document.getElementById('main-content');

        const storyGridSection = document.getElementById('story-grid-section');
        const storyDisplaySection = document.getElementById('story-display-section');
        const storyBoxes = document.querySelectorAll('.story-box');
        const backBtn = document.getElementById('back-btn');
        const storyTitleEl = document.getElementById('story-title');
        const storyContentEl = document.getElementById('story-content');
        const geminiFeaturesEl = document.getElementById('gemini-features');
        const geminiOutputEl = document.getElementById('gemini-output');
        
        let userApiKey = "";
        let currentStoryId = null;

        // --- Gemini API Call ---
        async function callGeminiAPI(payload) {
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${userApiKey}`;
            geminiOutputEl.innerHTML = '<div class="loader"></div><p class="text-center text-slate-500">சிந்திக்கிறேன்...</p>';
            geminiOutputEl.classList.remove('hidden');

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                if (!response.ok) {
                     const errorData = await response.json();
                     console.error("API Error Response:", errorData);
                     throw new Error(`API பிழை: ${response.status}. உங்கள் API சாவியைச் சரிபார்க்கவும்.`);
                }
                const data = await response.json();
                if (!data.candidates || data.candidates.length === 0) {
                    throw new Error("API யிடமிருந்து சரியான பதில் வரவில்லை.");
                }
                return data;
            } catch (error) {
                console.error("Gemini API call failed:", error);
                geminiOutputEl.innerHTML = `<p class="text-red-500 text-center">மன்னிக்கவும், ஒரு பிழை ஏற்பட்டது. ${error.message}</p>`;
                return null;
            }
        }

        function simplifyStory() {
            const storyText = stories[currentStoryId].content.replace(/<[^>]*>/g, "");
            const payload = {
                contents: [{
                    parts: [{ text: `கீழே உள்ள கதையை, வாசிக்கச் சிரமப்படும் ஒரு கடைநிலை மாணவருக்கு விளக்குவது போல, மிகவும் எளிய தமிழில் விளக்கவும். கதை: "${storyText}"` }]
                }]
            };
            callGeminiAPI(payload).then(result => {
                if (result) {
                    const simplifiedText = result.candidates[0].content.parts[0].text;
                    geminiOutputEl.innerHTML = `<h3 class="font-bold text-lg mb-2">எளிய விளக்கம்:</h3><p>${simplifiedText.replace(/\n/g, '<br>')}</p>`;
                }
            });
        }
        
        // --- UI Functions ---
        function showStory(storyId) {
            const story = stories[storyId];
            if (!story) return;

            currentStoryId = storyId;
            storyTitleEl.textContent = story.title;
            storyContentEl.innerHTML = story.content;

            geminiOutputEl.innerHTML = '';
            geminiOutputEl.classList.add('hidden');
            geminiFeaturesEl.innerHTML = `<button id="simplify-btn" class="px-4 py-2 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 transition">✨ கதையை எளிமையாக விளக்கு</button>`;
            document.getElementById('simplify-btn').addEventListener('click', simplifyStory);

            storyGridSection.classList.add('hidden');
            storyDisplaySection.classList.remove('hidden');
            storyDisplaySection.classList.add('fade-in');
        }

        function showMenu() {
            storyDisplaySection.classList.add('hidden');
            storyGridSection.classList.remove('hidden');
            storyGridSection.classList.add('fade-in');
            currentStoryId = null;
        }

        // --- Event Listeners ---
        storyBoxes.forEach(box => {
            box.addEventListener('click', () => showStory(box.dataset.storyId));
        });

        backBtn.addEventListener('click', showMenu);

        saveApiKeyBtn.addEventListener('click', () => {
            const key = apiKeyInput.value.trim();
            if (key) {
                userApiKey = key;
                apiKeyModal.classList.add('hidden');
                mainContent.classList.remove('hidden');
                mainContent.classList.add('fade-in');
            } else {
                alert("தயவுசெய்து உங்கள் API சாவியை உள்ளிடவும்.");
            }
        });

    </script>
</body>
</html>

